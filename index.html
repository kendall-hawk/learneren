<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learner</title>
    
    <!-- PWAè®¾ç½® -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Learner">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="js/core.js" as="script">
    <link rel="preload" href="data/navigation.json" as="fetch" crossorigin>
    
    <!-- å­—ä½“é¢„åŠ è½½ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Antic+Slab&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=emoji_objects" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=emoji_objects" />
    
    
    <!-- ä¸»æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="css/style.css">

    <!-- å…³é”®CSSå†…è”ï¼ˆé˜²é—ªçƒï¼‰ -->
    <style>
        /* åŸºç¡€å¸ƒå±€é˜²é—ªçƒ */
        body { opacity: 0; transition: opacity 0.3s ease; }
        body.loaded { opacity: 1; }
        
        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .loading-indicator {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #ffffff; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; gap: 1rem;
        }
        
        .loading-spinner {
            width: 32px; height: 32px;
            border: 3px solid #f3f3f3; border-top: 3px solid #007bff;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* é”™è¯¯å¤„ç† */
        .error-boundary {
            text-align: center; padding: 2rem; color: #dc3545;
            background: #f8f9fa; border-radius: 0.5rem; margin: 1rem;
        }
        
        /* ç¡®ä¿ä¸‹æ‹‰èœå•ä¸è¢«æˆªæ–­ */
        .site-header {
            overflow: visible !important;
        }
        
        .main-navigation {
            overflow: visible !important;
        }
    </style>
    <!-- 3. JavaScriptæ™ºèƒ½æ»šåŠ¨æ§åˆ¶ - æ·»åŠ åˆ°é¡µé¢åº•éƒ¨ -->

</head>

<body>
    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading-indicator" class="loading-indicator">
        <div class="loading-spinner" aria-label="åŠ è½½ä¸­"></div>
        <div class="loading-text">æ­£åœ¨åŠ è½½åº”ç”¨...</div>
    </div>
    
<header class="site-header smart-header" role="banner">
    <!-- å“ç‰Œå¤´éƒ¨ - å§‹ç»ˆæ˜¾ç¤º -->
    <div class="brand-header">
        <div class="brand-container">
            <h1 class="brand-title">
                <span class="brand-text">learner
                </span>
                <span class="brand-en">En
                    </span>
            </h1>
        </div>
    </div>
    <button onclick="useStandaloneMode()" style="position: fixed; top: 160px; right: 10px; z-index: 9999; background: #28a745; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸš€ ç‹¬ç«‹æ¨¡å¼
</button>
        <!-- ä¸´æ—¶æ·»åŠ åˆ°é¡µé¢é¡¶éƒ¨ -->
    <button onclick="diagnoseWordFreq()" style="position: fixed; top: 110px; right: 10px; z-index: 9999; background: #ffc107; color: black; border: none; padding: 10px; border-radius: 5px;">
    ğŸ” è¯Šæ–­è¯é¢‘
</button>
<button onclick="checkScripts()" style="position: fixed; top: 210px; right: 10px; z-index: 9999; background: #dc3545; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸ“‹ æ£€æŸ¥è„šæœ¬
</button>
<button onclick="checkWordFreqClasses()" style="position: fixed; top: 260px; right: 10px; z-index: 9999; background: #17a2b8; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸ” æ£€æŸ¥ç±»
</button>
<button onclick="fixWordFreqClasses()" style="position: fixed; top: 310px; right: 10px; z-index: 9999; background: #e83e8c; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸ”§ ä¿®å¤ç±»
</button>
<button onclick="retryStandalone()" style="position: fixed; top: 360px; right: 10px; z-index: 9999; background: #6f42c1; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸ”„ é‡è¯•ç‹¬ç«‹
</button>
<button onclick="checkScriptErrors()" style="position: fixed; top: 410px; right: 10px; z-index: 9999; background: #fd7e14; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸš¨ æ£€æŸ¥é”™è¯¯
</button>
<button onclick="createMinimalWordFreq()" style="position: fixed; top: 460px; right: 10px; z-index: 9999; background: #20c997; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸ› ï¸ æœ€å°ç‰ˆæœ¬
</button>
    <!-- å¯¼èˆªæ  - æ™ºèƒ½éšè—/æ˜¾ç¤º -->
    <nav id="main-nav" class="main-navigation smart-nav" role="navigation" aria-label="ä¸»å¯¼èˆª">
        <!-- å¯¼èˆªå†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </nav>
</header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main id="content" class="content-area" role="main">
        <!-- å†…å®¹å°†ç”±JavaScriptåŠ¨æ€åŠ è½½ -->
        <div style="text-align: center; padding: 40px;">
            <h1>æ¬¢è¿ä½¿ç”¨ Learner</h1>
            <p>æ­£åœ¨åŠ è½½å¯¼èˆªå’Œå†…å®¹...</p>
        </div>
    </main>
    
    
    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button id="back-to-top" class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨" title="è¿”å›é¡¶éƒ¨">
        <span aria-hidden="true">â†‘</span>
    </button>
    
    <!-- ç« èŠ‚å¯¼èˆª -->
    <div id="chapter-nav-container" role="navigation" aria-label="ç« èŠ‚å¯¼èˆª">
        <!-- ç« èŠ‚å¯¼èˆªæŒ‰é’®å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
    <div id="player-section" style="display: none;" role="contentinfo">
        <audio id="audio-player" controls preload="none" aria-label="ç« èŠ‚éŸ³é¢‘">
            <p>æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾åŠŸèƒ½ã€‚</p>
        </audio>
    </div>
    
    <!-- è¯æ±‡è¡¨å¼¹çª— -->
    <div id="glossary-popup" class="glossary-popup glossary-hidden" role="dialog" aria-modal="true" aria-labelledby="glossary-word">
        <div class="glossary-header">
            <h3 id="glossary-word" tabindex="-1"></h3>
            <div class="glossary-part-of-speech" aria-label="è¯æ€§"></div>
        </div>
        <div class="glossary-popup-content">
            <div class="glossary-main-definition-container" aria-label="ä¸»è¦å®šä¹‰"></div>
            <div class="glossary-contextual-meaning-container" aria-label="è¯­å¢ƒå«ä¹‰"></div>
            <div class="glossary-example-container" aria-label="ä¾‹å¥"></div>
            <dl class="glossary-details-list" aria-label="è¯¦ç»†ä¿¡æ¯"></dl>
        </div>
    </div>



    <!-- åœ¨å…¶ä»–JSæ–‡ä»¶ä¹‹å‰åŠ è½½ -->
    <script src="js/core.js" defer></script>
    <!-- JavaScriptæ¨¡å—åŠ è½½ -->
    <script>
function createMinimalWordFreq() {
    try {
        alert('ğŸ› ï¸ åˆ›å»ºæœ€å°è¯é¢‘ç®¡ç†å™¨...');
        
        // åˆ›å»ºæœ€å°è¯é¢‘ç®¡ç†å™¨
        class MinimalWordFreqManager {
            constructor() {
                this.isInitialized = false;
                this.initPromise = this.initialize();
            }
            
            async initialize() {
                // æ¨¡æ‹Ÿåˆå§‹åŒ–
                await new Promise(resolve => setTimeout(resolve, 1000));
                this.isInitialized = true;
                return true;
            }
            
            async waitForReady() {
                return this.initPromise;
            }
            
            getTopWords(limit = 100) {
                // è¿”å›ç¤ºä¾‹æ•°æ®
                return [
                    { word: 'example', totalCount: 10, articleCount: 3 },
                    { word: 'test', totalCount: 8, articleCount: 2 },
                    { word: 'demo', totalCount: 6, articleCount: 2 }
                ];
            }
            
            searchWords(query) {
                return [
                    { word: query, totalCount: 5, articleCount: 1, isIntelligentMatch: true }
                ];
            }
            
            searchWordsExact(query) {
                return [
                    { word: query, totalCount: 3, articleCount: 1, isExactMatch: true }
                ];
            }
            
            getWordDetails(word) {
                return {
                    word: word,
                    totalCount: 5,
                    articleCount: 2,
                    articles: [
                        { id: 'demo1', title: 'ç¤ºä¾‹æ–‡ç« 1', count: 3 },
                        { id: 'demo2', title: 'ç¤ºä¾‹æ–‡ç« 2', count: 2 }
                    ]
                };
            }
            
            getStatsSummary() {
                return {
                    totalUniqueWords: 1000,
                    totalWordOccurrences: 5000,
                    totalArticlesAnalyzed: 50,
                    averageWordsPerArticle: 100
                };
            }
            
            getArticleDifficulty(articleId) {
                return {
                    stars: 3,
                    label: "â­â­â­ ä¸­ç­‰",
                    tooltip: "æ¼”ç¤ºéš¾åº¦"
                };
            }
            
            destroy() {
                this.isInitialized = false;
            }
        }
        
        // æ³¨å†Œåˆ°EnglishSite
        window.EnglishSite.WordFrequencyManager = MinimalWordFreqManager;
        
        alert('âœ… æœ€å°è¯é¢‘ç®¡ç†å™¨åˆ›å»ºæˆåŠŸï¼');
        
        // ç«‹å³æµ‹è¯•
        testMinimalVersion();
        
    } catch (error) {
        alert('âŒ åˆ›å»ºå¤±è´¥: ' + error.message);
    }
}

function testMinimalVersion() {
    try {
        alert('ğŸ§ª æµ‹è¯•æœ€å°ç‰ˆæœ¬...');
        
        const container = document.querySelector('#content');
        if (!container) {
            alert('âŒ æ‰¾ä¸åˆ°å®¹å™¨');
            return;
        }
        
        // æ£€æŸ¥UIç±»
        if (!window.EnglishSite.WordFrequencyUI) {
            alert('âŒ UIç±»ä¸å­˜åœ¨');
            return;
        }
        
        // æ¸…ç©ºå®¹å™¨
        container.innerHTML = '<div style="text-align: center; padding: 50px; background: #e8f5e8;"><h2>ğŸ”¤ æœ€å°ç‰ˆè¯é¢‘å·¥å…·</h2><p>æ­£åœ¨å¯åŠ¨æ¼”ç¤ºç‰ˆæœ¬...</p></div>';
        
        // åˆ›å»ºå®ä¾‹
        const manager = new window.EnglishSite.WordFrequencyManager();
        const ui = new window.EnglishSite.WordFrequencyUI(container, manager);
        
        alert('âœ… å®ä¾‹åˆ›å»ºæˆåŠŸï¼Œå¼€å§‹åˆå§‹åŒ–...');
        
        // åˆå§‹åŒ–
        manager.waitForReady()
            .then(() => {
                alert('âœ… ç®¡ç†å™¨å°±ç»ªï¼Œåˆå§‹åŒ–UI...');
                return ui.initialize();
            })
            .then(() => {
                alert('ğŸ‰ æœ€å°ç‰ˆè¯é¢‘å·¥å…·å¯åŠ¨æˆåŠŸï¼è¿™æ˜¯æ¼”ç¤ºç‰ˆæœ¬ï¼ŒåŒ…å«ç¤ºä¾‹æ•°æ®ã€‚');
                
                // ä¿å­˜åˆ°å…¨å±€
                window.wordFreqManager = manager;
                window.wordFreqUI = ui;
            })
            .catch(error => {
                alert('âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                container.innerHTML = `
                    <div style="padding: 20px; color: red; text-align: center;">
                        <h3>åˆå§‹åŒ–å¤±è´¥</h3>
                        <p>${error.message}</p>
                        <button onclick="location.reload()">é‡æ–°åŠ è½½é¡µé¢</button>
                    </div>
                `;
            });
            
    } catch (error) {
        alert('âŒ æµ‹è¯•å¤±è´¥: ' + error.message);
    }
}
</script>
    <script>
function checkScriptErrors() {
    alert('ğŸš¨ æ£€æŸ¥è„šæœ¬æ‰§è¡ŒçŠ¶æ€...');
    
    // æ£€æŸ¥è¯é¢‘è„šæœ¬æ˜¯å¦å®Œå…¨æ‰§è¡Œ
    const checks = [
        'SimplifiedWordStemmer',
        'SimplifiedWordFrequencyAnalyzer', 
        'SimplifiedWordFrequencyManager',
        'CompatibilityLayer'
    ];
    
    let result = 'è„šæœ¬æ‰§è¡Œæ£€æŸ¥:\n';
    checks.forEach(className => {
        const exists = typeof window[className] !== 'undefined';
        result += `â€¢ ${className}: ${exists ? 'âœ…' : 'âŒ'}\n`;
    });
    
    alert(result);
    
    // æ£€æŸ¥æ˜¯å¦æœ‰éƒ¨åˆ†ç±»åœ¨å…¶ä»–åœ°æ–¹
    const globalVars = Object.getOwnPropertyNames(window).filter(name => 
        name.includes('Word') || name.includes('Freq') || name.includes('Stemmer')
    );
    
    alert(`å…¨å±€è¯é¢‘ç›¸å…³å˜é‡:\n${globalVars.join('\n') || 'æ— '}`);
}
</script>
    <script>
function retryStandalone() {
    alert('ğŸ”„ é‡æ–°å°è¯•ç‹¬ç«‹æ¨¡å¼...');
    
    // ç¡®ä¿ç±»å­˜åœ¨
    if (!window.EnglishSite?.WordFrequencyManager) {
        alert('âŒ ç®¡ç†å™¨ç±»ä»ç„¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ"ä¿®å¤ç±»"');
        return;
    }
    
    if (!window.EnglishSite?.WordFrequencyUI) {
        alert('âŒ UIç±»ä¸å­˜åœ¨');
        return;
    }
    
    try {
        const container = document.querySelector('#content');
        container.innerHTML = '<div style="text-align: center; padding: 50px; background: #f0f8ff;"><h2>ğŸ”¤ è¯é¢‘åˆ†æå·¥å…·</h2><p>æ­£åœ¨å¯åŠ¨ä¿®å¤ç‰ˆ...</p></div>';
        
        // åˆ›å»ºå®ä¾‹
        const manager = new window.EnglishSite.WordFrequencyManager();
        const ui = new window.EnglishSite.WordFrequencyUI(container, manager);
        
        alert('âœ… å®ä¾‹åˆ›å»ºæˆåŠŸï¼Œç­‰å¾…åˆå§‹åŒ–...');
        
        // ç­‰å¾…åˆå§‹åŒ–
        manager.waitForReady()
            .then(() => {
                alert('âœ… ç®¡ç†å™¨å°±ç»ªï¼Œåˆå§‹åŒ–UI...');
                return ui.initialize();
            })
            .then(() => {
                alert('ğŸ‰ è¯é¢‘å·¥å…·å¯åŠ¨æˆåŠŸï¼');
                // ä¿å­˜åˆ°å…¨å±€ä»¥ä¾¿è°ƒè¯•
                window.wordFreqManager = manager;
                window.wordFreqUI = ui;
            })
            .catch(error => {
                alert('âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                container.innerHTML = `<div style="padding: 20px; color: red;">åˆå§‹åŒ–å¤±è´¥: ${error.message}</div>`;
            });
            
    } catch (error) {
        alert('âŒ åˆ›å»ºå®ä¾‹å¤±è´¥: ' + error.message);
    }
}
</script>
  
    <script>
function fixWordFreqClasses() {
    try {
        alert('ğŸ”§ å°è¯•æ‰‹åŠ¨ä¿®å¤ç±»æ³¨å†Œ...');
        
        // æ£€æŸ¥æ˜¯å¦æœ‰å…¨å±€ç±»å¯ç”¨
        if (typeof window.SimplifiedWordFrequencyManager !== 'undefined') {
            alert('âœ… æ‰¾åˆ°å…¨å±€SimplifiedWordFrequencyManagerï¼Œå¼€å§‹ä¿®å¤...');
            
            // æ‰‹åŠ¨æ³¨å†Œåˆ° EnglishSite
            window.EnglishSite = window.EnglishSite || {};
            window.EnglishSite.WordFrequencyManager = window.SimplifiedWordFrequencyManager;
            
            alert('âœ… å·²æ‰‹åŠ¨æ³¨å†ŒWordFrequencyManagerç±»');
        } else if (typeof window.WordFrequencyManager !== 'undefined') {
            alert('âœ… æ‰¾åˆ°å…¨å±€WordFrequencyManager');
            window.EnglishSite.WordFrequencyManager = window.WordFrequencyManager;
        } else {
            alert('âŒ æ‰¾ä¸åˆ°ä»»ä½•è¯é¢‘ç®¡ç†å™¨ç±»');
            return;
        }
        
        // æ£€æŸ¥å…¶ä»–å¿…è¦çš„ç±»
        const requiredClasses = [
            'SimplifiedWordFrequencyAnalyzer',
            'SimplifiedWordStemmer', 
            'WordFrequencyUI',
            'SimplifiedSearchManager'
        ];
        
        requiredClasses.forEach(className => {
            if (window[className] && !window.EnglishSite[className]) {
                window.EnglishSite[className] = window[className];
                alert(`âœ… å·²æ³¨å†Œ ${className}`);
            }
        });
        
        // éªŒè¯ä¿®å¤ç»“æœ
        const hasManager = !!window.EnglishSite.WordFrequencyManager;
        const hasUI = !!window.EnglishSite.WordFrequencyUI;
        
        alert(`ä¿®å¤ç»“æœ:\nâ€¢ WordFrequencyManager: ${hasManager ? 'âœ…' : 'âŒ'}\nâ€¢ WordFrequencyUI: ${hasUI ? 'âœ…' : 'âŒ'}`);
        
        if (hasManager && hasUI) {
            alert('ğŸ‰ ç±»ä¿®å¤æˆåŠŸï¼ç°åœ¨å¯ä»¥å°è¯•ç‹¬ç«‹æ¨¡å¼äº†');
        }
        
    } catch (error) {
        alert('âŒ ä¿®å¤å¤±è´¥: ' + error.message);
    }
}
</script>
 <script>
function checkWordFreqClasses() {
    alert('ğŸ” æ£€æŸ¥è¯é¢‘ç›¸å…³ç±»...');
    
    // æ£€æŸ¥ EnglishSite å¯¹è±¡çš„å†…å®¹
    const englishSite = window.EnglishSite || {};
    const keys = Object.keys(englishSite);
    
    alert(`EnglishSite åŒ…å«çš„ç±»:\n${keys.join('\n')}`);
    
    // æ£€æŸ¥å…·ä½“çš„è¯é¢‘ç›¸å…³ç±»
    const checks = {
        'WordFrequencyManager': !!englishSite.WordFrequencyManager,
        'SimplifiedWordFrequencyManager': !!window.SimplifiedWordFrequencyManager,
        'WordFrequencyUI': !!englishSite.WordFrequencyUI,
        'SimplifiedWordFrequencyAnalyzer': !!englishSite.SimplifiedWordFrequencyAnalyzer,
        'SimplifiedWordStemmer': !!englishSite.SimplifiedWordStemmer
    };
    
    let result = 'ç±»æ£€æŸ¥ç»“æœ:\n';
    for (const [name, exists] of Object.entries(checks)) {
        result += `â€¢ ${name}: ${exists ? 'âœ…' : 'âŒ'}\n`;
    }
    
    alert(result);
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å…¨å±€çš„è¯é¢‘ç±»ï¼ˆå¯èƒ½æ²¡æœ‰æ­£ç¡®å¯¼å‡ºï¼‰
    const globalChecks = {
        'window.SimplifiedWordFrequencyManager': typeof window.SimplifiedWordFrequencyManager,
        'window.WordFrequencyUI': typeof window.WordFrequencyUI,
        'window.SimplifiedWordFrequencyAnalyzer': typeof window.SimplifiedWordFrequencyAnalyzer
    };
    
    let globalResult = 'å…¨å±€ç±»æ£€æŸ¥:\n';
    for (const [name, type] of Object.entries(globalChecks)) {
        globalResult += `â€¢ ${name}: ${type}\n`;
    }
    
    alert(globalResult);
}
</script>
    <script>
function checkScripts() {
    const scripts = document.querySelectorAll('script[src]');
    let wordFreqScript = null;
    let mainScript = null;
    
    scripts.forEach(script => {
        if (script.src.includes('word-frequency')) {
            wordFreqScript = script.src;
        }
        if (script.src.includes('main.js')) {
            mainScript = script.src;
        }
    });
    
    alert(`è„šæœ¬æ£€æŸ¥:\nâ€¢ æ€»è„šæœ¬æ•°: ${scripts.length}\nâ€¢ è¯é¢‘è„šæœ¬: ${wordFreqScript ? 'âœ…' : 'âŒ'}\nâ€¢ ä¸»è„šæœ¬: ${mainScript ? 'âœ…' : 'âŒ'}\nâ€¢ EnglishSite: ${!!window.EnglishSite ? 'âœ…' : 'âŒ'}`);
    
    if (wordFreqScript) {
        alert(`è¯é¢‘è„šæœ¬è·¯å¾„: ${wordFreqScript}`);
    }
}
</script>
    <script>
function useStandaloneMode() {
    try {
        alert('ğŸš€ å°è¯•ç‹¬ç«‹æ¨¡å¼å¯åŠ¨...');
        
        // æ¸…ç©ºå½“å‰å†…å®¹
        const container = document.querySelector('#content') || 
                         document.querySelector('main') || 
                         document.body;
        
        if (!container) {
            alert('âŒ æ‰¾ä¸åˆ°å®¹å™¨');
            return;
        }
        
        // æ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨
        if (!window.EnglishSite?.WordFrequencyManager) {
            alert('âŒ è¯é¢‘ç®¡ç†å™¨ç±»ä¸å­˜åœ¨');
            return;
        }
        
        if (!window.EnglishSite?.WordFrequencyUI) {
            alert('âŒ è¯é¢‘UIç±»ä¸å­˜åœ¨');
            return;
        }
        
        alert('âœ… ç±»æ£€æŸ¥é€šè¿‡ï¼Œå¼€å§‹åˆ›å»ºå®ä¾‹...');
        
        // æ¸…ç©ºå®¹å™¨
        container.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>ğŸ”¤ è¯é¢‘åˆ†æå·¥å…·</h2><p>æ­£åœ¨å¯åŠ¨ç‹¬ç«‹æ¨¡å¼...</p></div>';
        
        // åˆ›å»ºç‹¬ç«‹çš„è¯é¢‘ç®¡ç†å™¨
        const manager = new window.EnglishSite.WordFrequencyManager();
        const ui = new window.EnglishSite.WordFrequencyUI(container, manager);
        
        // ç­‰å¾…åˆå§‹åŒ–
        manager.waitForReady().then(() => {
            alert('âœ… ç®¡ç†å™¨å‡†å¤‡å°±ç»ªï¼Œåˆå§‹åŒ–UI...');
            return ui.initialize();
        }).then(() => {
            alert('ğŸ‰ ç‹¬ç«‹æ¨¡å¼å¯åŠ¨æˆåŠŸï¼');
        }).catch(error => {
            alert('âŒ ç‹¬ç«‹æ¨¡å¼å¤±è´¥: ' + error.message);
        });
        
    } catch (error) {
        alert('âŒ ç‹¬ç«‹æ¨¡å¼å¼‚å¸¸: ' + error.message);
    }
}
</script>
<script>
function diagnoseWordFreq() {
    let step = 1;
    
    try {
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥Appå®ä¾‹...`);
        if (!window.app) {
            alert('âŒ Appå®ä¾‹ä¸å­˜åœ¨');
            return;
        }
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥å®¹å™¨...`);
        const content = document.querySelector('#content');
        const main = document.querySelector('main');
        const container = content || main || document.body;
        if (!container) {
            alert('âŒ æ‰¾ä¸åˆ°å®¹å™¨');
            return;
        }
        alert(`âœ… æ‰¾åˆ°å®¹å™¨: ${container.tagName}#${container.id}`);
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥è¯é¢‘ç®¡ç†å™¨çŠ¶æ€...`);
        const hasManager = !!window.app.wordFreqManager;
        const isInitialized = window.app.state?.wordFreqInitialized;
        const hasPromise = !!window.app.wordFreqManagerPromise;
        alert(`ç®¡ç†å™¨å­˜åœ¨: ${hasManager}\nå·²åˆå§‹åŒ–: ${isInitialized}\næœ‰Promise: ${hasPromise}`);
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥è¯é¢‘ç±»...`);
        const hasManagerClass = !!window.EnglishSite?.WordFrequencyManager;
        const hasUIClass = !!window.EnglishSite?.WordFrequencyUI;
        alert(`ç®¡ç†å™¨ç±»: ${hasManagerClass}\nUIç±»: ${hasUIClass}`);
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥å…¨å±€å‡½æ•°...`);
        const hasGlobalFunc = typeof window.navigateToWordFrequency === 'function';
        alert(`å…¨å±€å‡½æ•°: ${hasGlobalFunc}`);
        
        if (hasGlobalFunc) {
            alert(`æ­¥éª¤${step++}: å°è¯•ç›´æ¥è°ƒç”¨å…¨å±€å‡½æ•°...`);
            try {
                const result = window.navigateToWordFrequency();
                alert(`ç›´æ¥è°ƒç”¨ç»“æœ: ${result}`);
            } catch (err) {
                alert(`ç›´æ¥è°ƒç”¨å¤±è´¥: ${err.message}`);
            }
        }
        
    } catch (error) {
        alert(`è¯Šæ–­åœ¨æ­¥éª¤${step}å¤±è´¥: ${error.message}`);
    }
}
</script>
    <script>
        // åŸºç¡€é”™è¯¯å¤„ç†å’Œè¶…æ—¶æ£€æµ‹
        window.addEventListener('error', function(e) {
            console.error('åº”ç”¨é”™è¯¯:', e.error);
            const indicator = document.getElementById('loading-indicator');
            if (indicator) {
                indicator.innerHTML = `
                    <div class="error-boundary">
                        <h2>ğŸš« åŠ è½½å¤±è´¥</h2>
                        <p>åº”ç”¨å¯åŠ¨æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ğŸ”„ é‡æ–°åŠ è½½
                        </button>
                    </div>
                `;
            }
        });
        
        // è¶…æ—¶æ£€æµ‹ï¼ˆ15ç§’ï¼‰
        setTimeout(function() {
            if (!window.EnglishSite || !document.body.classList.contains('loaded')) {
                const indicator = document.getElementById('loading-indicator');
                if (indicator && indicator.style.display !== 'none') {
                    indicator.innerHTML = `
                        <div class="error-boundary">
                            <h3>â±ï¸ åŠ è½½è¶…æ—¶</h3>
                            <p>ç½‘ç»œè¿æ¥å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚</p>
                            <button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">é‡æ–°åŠ è½½</button>
                        </div>
                    `;
                }
            }
        }, 15000);
        
        // åº”ç”¨å¯åŠ¨å®Œæˆå¤„ç†
        document.addEventListener('DOMContentLoaded', function() {
            function hideLoading() {
                const indicator = document.getElementById('loading-indicator');
                if (indicator) {
                    indicator.style.opacity = '0';
                    setTimeout(() => {
                        indicator.style.display = 'none';
                        document.body.classList.add('loaded');
                    }, 300);
                }
            }
            
            // ç­‰å¾…åº”ç”¨åˆå§‹åŒ–å®Œæˆ
            if (window.EnglishSite && window.EnglishSite.coreToolsReady) {
                window.EnglishSite.coreToolsReady.then(() => {
                    // é¢å¤–ç­‰å¾…ç¡®ä¿å¯¼èˆªæ¸²æŸ“å®Œæˆ
                    setTimeout(hideLoading, 800);
                }).catch(() => {
                    hideLoading();
                });
            } else {
                // é™çº§å¤„ç†
                setTimeout(hideLoading, 2000);
            }
        });
        
// æŒ‰Ctrl+
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        if (!document.getElementById('debug-panel')) {
            loadDebugTool();
        }
    }
});

function loadDebugTool() {
    // åœ¨è¿™é‡Œæ’å…¥è°ƒè¯•å·¥å…·çš„CSSå’ŒJavaScriptä»£ç 
    // ... (ä»ä¸Šé¢çš„HTMLä¸­å¤åˆ¶ <style> å’Œ <script> éƒ¨åˆ†)
}
    </script>
    
    <!-- æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆå¿…é¡»æœ€å…ˆåŠ è½½ï¼‰ -->
    
    <!-- åŠŸèƒ½æ¨¡å—ï¼ˆæŒ‰ä¾èµ–é¡ºåºåŠ è½½ï¼‰ -->
    <script src="js/navigation.js" defer></script>
    <script src="js/audio-sync.js" defer></script>
    <script src="js/glossary.js" defer></script>
    
    <!-- è¯é¢‘å·¥å…·æ¨¡å— -->
    <script src="js/word-frequency.js" defer></script>
    <script src="js/word-frequency-ui.js" defer></script>
    <script src="js/word-frequency-global.js"></script>
    <script src="js/word-highlight.js" defer></script>
    
    <!-- ä¸»åº”ç”¨ï¼ˆæœ€ååŠ è½½ï¼‰ -->
    <script src="js/main.js" defer></script>
</body>
</html>