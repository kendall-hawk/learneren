<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learner</title>
    
    <!-- PWAè®¾ç½® -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Learner">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="js/core.js" as="script">
    <link rel="preload" href="data/navigation.json" as="fetch" crossorigin>
    
    <!-- å­—ä½“é¢„åŠ è½½ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Antic+Slab&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=emoji_objects" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=emoji_objects" />
    
    
    <!-- ä¸»æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="css/style.css">

    <!-- å…³é”®CSSå†…è”ï¼ˆé˜²é—ªçƒï¼‰ -->
    <style>
        /* åŸºç¡€å¸ƒå±€é˜²é—ªçƒ */
        body { opacity: 0; transition: opacity 0.3s ease; }
        body.loaded { opacity: 1; }
        
        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .loading-indicator {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #ffffff; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; gap: 1rem;
        }
        
        .loading-spinner {
            width: 32px; height: 32px;
            border: 3px solid #f3f3f3; border-top: 3px solid #007bff;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* é”™è¯¯å¤„ç† */
        .error-boundary {
            text-align: center; padding: 2rem; color: #dc3545;
            background: #f8f9fa; border-radius: 0.5rem; margin: 1rem;
        }
        
        /* ç¡®ä¿ä¸‹æ‹‰èœå•ä¸è¢«æˆªæ–­ */
        .site-header {
            overflow: visible !important;
        }
        
        .main-navigation {
            overflow: visible !important;
        }
    </style>
    <!-- 3. JavaScriptæ™ºèƒ½æ»šåŠ¨æ§åˆ¶ - æ·»åŠ åˆ°é¡µé¢åº•éƒ¨ -->

</head>

<body>
    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading-indicator" class="loading-indicator">
        <div class="loading-spinner" aria-label="åŠ è½½ä¸­"></div>
        <div class="loading-text">æ­£åœ¨åŠ è½½åº”ç”¨...</div>
    </div>
    
<header class="site-header smart-header" role="banner">
    <!-- å“ç‰Œå¤´éƒ¨ - å§‹ç»ˆæ˜¾ç¤º -->
    <div class="brand-header">
        <div class="brand-container">
            <h1 class="brand-title">
                <span class="brand-text">learner
                </span>
                <span class="brand-en">En
                    </span>
            </h1>
        </div>
    </div>
    <button onclick="useStandaloneMode()" style="position: fixed; top: 160px; right: 10px; z-index: 9999; background: #28a745; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸš€ ç‹¬ç«‹æ¨¡å¼
</button>
        <!-- ä¸´æ—¶æ·»åŠ åˆ°é¡µé¢é¡¶éƒ¨ -->
    <button onclick="diagnoseWordFreq()" style="position: fixed; top: 110px; right: 10px; z-index: 9999; background: #ffc107; color: black; border: none; padding: 10px; border-radius: 5px;">
    ğŸ” è¯Šæ–­è¯é¢‘
</button>
<button onclick="checkScripts()" style="position: fixed; top: 210px; right: 10px; z-index: 9999; background: #dc3545; color: white; border: none; padding: 10px; border-radius: 5px;">
    ğŸ“‹ æ£€æŸ¥è„šæœ¬
</button>

    <!-- å¯¼èˆªæ  - æ™ºèƒ½éšè—/æ˜¾ç¤º -->
    <nav id="main-nav" class="main-navigation smart-nav" role="navigation" aria-label="ä¸»å¯¼èˆª">
        <!-- å¯¼èˆªå†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </nav>
</header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main id="content" class="content-area" role="main">
        <!-- å†…å®¹å°†ç”±JavaScriptåŠ¨æ€åŠ è½½ -->
        <div style="text-align: center; padding: 40px;">
            <h1>æ¬¢è¿ä½¿ç”¨ Learner</h1>
            <p>æ­£åœ¨åŠ è½½å¯¼èˆªå’Œå†…å®¹...</p>
        </div>
    </main>
    
    
    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button id="back-to-top" class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨" title="è¿”å›é¡¶éƒ¨">
        <span aria-hidden="true">â†‘</span>
    </button>
    
    <!-- ç« èŠ‚å¯¼èˆª -->
    <div id="chapter-nav-container" role="navigation" aria-label="ç« èŠ‚å¯¼èˆª">
        <!-- ç« èŠ‚å¯¼èˆªæŒ‰é’®å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
    <div id="player-section" style="display: none;" role="contentinfo">
        <audio id="audio-player" controls preload="none" aria-label="ç« èŠ‚éŸ³é¢‘">
            <p>æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾åŠŸèƒ½ã€‚</p>
        </audio>
    </div>
    
    <!-- è¯æ±‡è¡¨å¼¹çª— -->
    <div id="glossary-popup" class="glossary-popup glossary-hidden" role="dialog" aria-modal="true" aria-labelledby="glossary-word">
        <div class="glossary-header">
            <h3 id="glossary-word" tabindex="-1"></h3>
            <div class="glossary-part-of-speech" aria-label="è¯æ€§"></div>
        </div>
        <div class="glossary-popup-content">
            <div class="glossary-main-definition-container" aria-label="ä¸»è¦å®šä¹‰"></div>
            <div class="glossary-contextual-meaning-container" aria-label="è¯­å¢ƒå«ä¹‰"></div>
            <div class="glossary-example-container" aria-label="ä¾‹å¥"></div>
            <dl class="glossary-details-list" aria-label="è¯¦ç»†ä¿¡æ¯"></dl>
        </div>
    </div>



    <!-- åœ¨å…¶ä»–JSæ–‡ä»¶ä¹‹å‰åŠ è½½ -->
    <script src="js/core.js" defer></script>
    <!-- JavaScriptæ¨¡å—åŠ è½½ -->
    <script>
function checkScripts() {
    const scripts = document.querySelectorAll('script[src]');
    let wordFreqScript = null;
    let mainScript = null;
    
    scripts.forEach(script => {
        if (script.src.includes('word-frequency')) {
            wordFreqScript = script.src;
        }
        if (script.src.includes('main.js')) {
            mainScript = script.src;
        }
    });
    
    alert(`è„šæœ¬æ£€æŸ¥:\nâ€¢ æ€»è„šæœ¬æ•°: ${scripts.length}\nâ€¢ è¯é¢‘è„šæœ¬: ${wordFreqScript ? 'âœ…' : 'âŒ'}\nâ€¢ ä¸»è„šæœ¬: ${mainScript ? 'âœ…' : 'âŒ'}\nâ€¢ EnglishSite: ${!!window.EnglishSite ? 'âœ…' : 'âŒ'}`);
    
    if (wordFreqScript) {
        alert(`è¯é¢‘è„šæœ¬è·¯å¾„: ${wordFreqScript}`);
    }
}
</script>
    <script>
function useStandaloneMode() {
    try {
        alert('ğŸš€ å°è¯•ç‹¬ç«‹æ¨¡å¼å¯åŠ¨...');
        
        // æ¸…ç©ºå½“å‰å†…å®¹
        const container = document.querySelector('#content') || 
                         document.querySelector('main') || 
                         document.body;
        
        if (!container) {
            alert('âŒ æ‰¾ä¸åˆ°å®¹å™¨');
            return;
        }
        
        // æ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨
        if (!window.EnglishSite?.WordFrequencyManager) {
            alert('âŒ è¯é¢‘ç®¡ç†å™¨ç±»ä¸å­˜åœ¨');
            return;
        }
        
        if (!window.EnglishSite?.WordFrequencyUI) {
            alert('âŒ è¯é¢‘UIç±»ä¸å­˜åœ¨');
            return;
        }
        
        alert('âœ… ç±»æ£€æŸ¥é€šè¿‡ï¼Œå¼€å§‹åˆ›å»ºå®ä¾‹...');
        
        // æ¸…ç©ºå®¹å™¨
        container.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>ğŸ”¤ è¯é¢‘åˆ†æå·¥å…·</h2><p>æ­£åœ¨å¯åŠ¨ç‹¬ç«‹æ¨¡å¼...</p></div>';
        
        // åˆ›å»ºç‹¬ç«‹çš„è¯é¢‘ç®¡ç†å™¨
        const manager = new window.EnglishSite.WordFrequencyManager();
        const ui = new window.EnglishSite.WordFrequencyUI(container, manager);
        
        // ç­‰å¾…åˆå§‹åŒ–
        manager.waitForReady().then(() => {
            alert('âœ… ç®¡ç†å™¨å‡†å¤‡å°±ç»ªï¼Œåˆå§‹åŒ–UI...');
            return ui.initialize();
        }).then(() => {
            alert('ğŸ‰ ç‹¬ç«‹æ¨¡å¼å¯åŠ¨æˆåŠŸï¼');
        }).catch(error => {
            alert('âŒ ç‹¬ç«‹æ¨¡å¼å¤±è´¥: ' + error.message);
        });
        
    } catch (error) {
        alert('âŒ ç‹¬ç«‹æ¨¡å¼å¼‚å¸¸: ' + error.message);
    }
}
</script>
<script>
function diagnoseWordFreq() {
    let step = 1;
    
    try {
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥Appå®ä¾‹...`);
        if (!window.app) {
            alert('âŒ Appå®ä¾‹ä¸å­˜åœ¨');
            return;
        }
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥å®¹å™¨...`);
        const content = document.querySelector('#content');
        const main = document.querySelector('main');
        const container = content || main || document.body;
        if (!container) {
            alert('âŒ æ‰¾ä¸åˆ°å®¹å™¨');
            return;
        }
        alert(`âœ… æ‰¾åˆ°å®¹å™¨: ${container.tagName}#${container.id}`);
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥è¯é¢‘ç®¡ç†å™¨çŠ¶æ€...`);
        const hasManager = !!window.app.wordFreqManager;
        const isInitialized = window.app.state?.wordFreqInitialized;
        const hasPromise = !!window.app.wordFreqManagerPromise;
        alert(`ç®¡ç†å™¨å­˜åœ¨: ${hasManager}\nå·²åˆå§‹åŒ–: ${isInitialized}\næœ‰Promise: ${hasPromise}`);
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥è¯é¢‘ç±»...`);
        const hasManagerClass = !!window.EnglishSite?.WordFrequencyManager;
        const hasUIClass = !!window.EnglishSite?.WordFrequencyUI;
        alert(`ç®¡ç†å™¨ç±»: ${hasManagerClass}\nUIç±»: ${hasUIClass}`);
        
        alert(`æ­¥éª¤${step++}: æ£€æŸ¥å…¨å±€å‡½æ•°...`);
        const hasGlobalFunc = typeof window.navigateToWordFrequency === 'function';
        alert(`å…¨å±€å‡½æ•°: ${hasGlobalFunc}`);
        
        if (hasGlobalFunc) {
            alert(`æ­¥éª¤${step++}: å°è¯•ç›´æ¥è°ƒç”¨å…¨å±€å‡½æ•°...`);
            try {
                const result = window.navigateToWordFrequency();
                alert(`ç›´æ¥è°ƒç”¨ç»“æœ: ${result}`);
            } catch (err) {
                alert(`ç›´æ¥è°ƒç”¨å¤±è´¥: ${err.message}`);
            }
        }
        
    } catch (error) {
        alert(`è¯Šæ–­åœ¨æ­¥éª¤${step}å¤±è´¥: ${error.message}`);
    }
}
</script>
    <script>
        // åŸºç¡€é”™è¯¯å¤„ç†å’Œè¶…æ—¶æ£€æµ‹
        window.addEventListener('error', function(e) {
            console.error('åº”ç”¨é”™è¯¯:', e.error);
            const indicator = document.getElementById('loading-indicator');
            if (indicator) {
                indicator.innerHTML = `
                    <div class="error-boundary">
                        <h2>ğŸš« åŠ è½½å¤±è´¥</h2>
                        <p>åº”ç”¨å¯åŠ¨æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ğŸ”„ é‡æ–°åŠ è½½
                        </button>
                    </div>
                `;
            }
        });
        
        // è¶…æ—¶æ£€æµ‹ï¼ˆ15ç§’ï¼‰
        setTimeout(function() {
            if (!window.EnglishSite || !document.body.classList.contains('loaded')) {
                const indicator = document.getElementById('loading-indicator');
                if (indicator && indicator.style.display !== 'none') {
                    indicator.innerHTML = `
                        <div class="error-boundary">
                            <h3>â±ï¸ åŠ è½½è¶…æ—¶</h3>
                            <p>ç½‘ç»œè¿æ¥å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚</p>
                            <button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">é‡æ–°åŠ è½½</button>
                        </div>
                    `;
                }
            }
        }, 15000);
        
        // åº”ç”¨å¯åŠ¨å®Œæˆå¤„ç†
        document.addEventListener('DOMContentLoaded', function() {
            function hideLoading() {
                const indicator = document.getElementById('loading-indicator');
                if (indicator) {
                    indicator.style.opacity = '0';
                    setTimeout(() => {
                        indicator.style.display = 'none';
                        document.body.classList.add('loaded');
                    }, 300);
                }
            }
            
            // ç­‰å¾…åº”ç”¨åˆå§‹åŒ–å®Œæˆ
            if (window.EnglishSite && window.EnglishSite.coreToolsReady) {
                window.EnglishSite.coreToolsReady.then(() => {
                    // é¢å¤–ç­‰å¾…ç¡®ä¿å¯¼èˆªæ¸²æŸ“å®Œæˆ
                    setTimeout(hideLoading, 800);
                }).catch(() => {
                    hideLoading();
                });
            } else {
                // é™çº§å¤„ç†
                setTimeout(hideLoading, 2000);
            }
        });
        
// æŒ‰Ctrl+
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        if (!document.getElementById('debug-panel')) {
            loadDebugTool();
        }
    }
});

function loadDebugTool() {
    // åœ¨è¿™é‡Œæ’å…¥è°ƒè¯•å·¥å…·çš„CSSå’ŒJavaScriptä»£ç 
    // ... (ä»ä¸Šé¢çš„HTMLä¸­å¤åˆ¶ <style> å’Œ <script> éƒ¨åˆ†)
}
    </script>
    
    <!-- æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆå¿…é¡»æœ€å…ˆåŠ è½½ï¼‰ -->
    
    <!-- åŠŸèƒ½æ¨¡å—ï¼ˆæŒ‰ä¾èµ–é¡ºåºåŠ è½½ï¼‰ -->
    <script src="js/navigation.js" defer></script>
    <script src="js/audio-sync.js" defer></script>
    <script src="js/glossary.js" defer></script>
    
    <!-- è¯é¢‘å·¥å…·æ¨¡å— -->
    <script src="js/word-frequency.js" defer></script>
    <script src="js/word-frequency-ui.js" defer></script>
    <script src="js/word-frequency-global.js"></script>
    <script src="js/word-highlight.js" defer></script>
    
    <!-- ä¸»åº”ç”¨ï¼ˆæœ€ååŠ è½½ï¼‰ -->
    <script src="js/main.js" defer></script>
</body>
</html>